<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HistorianWeb</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#f4f6f8;--text:#1f2937;--card:#ffffff;--list:#f9fafb;
 --primary:#2563eb;--separator:rgba(37,99,235,.18)
}
@media(prefers-color-scheme:dark){
 :root{
  --bg:#0b1220;--text:#fff;--card:#020617;--list:#0a0a0a;
  --separator:rgba(96,165,250,.18)
 }
}
body{
 background:var(--bg);color:var(--text);
 font-family:"Inter",Helvetica,Arial,sans-serif
}
.card{
 background:var(--card);border-radius:16px;
 box-shadow:0 8px 22px rgba(0,0,0,.22)
}
.table td{
 background:var(--list);color:var(--text);
 border-bottom:1px solid var(--separator);
 padding:.55rem .3rem
}
.heart{cursor:pointer;font-size:1.15rem;margin-right:6px}
.nav-pills{gap:.4rem}
.nav-link{padding:.45rem .75rem;border-radius:10px}
input.form-control{
 background:#111;color:#f9fafb;border:1px solid #374151;
 border-radius:10px
}
input::placeholder{color:#9ca3af}
.footer{
 margin-top:1.5rem;padding:.75rem;text-align:center;
 font-size:.85rem;color:#94a3b8;
 box-shadow:inset 0 2px 6px rgba(0,0,0,.35)
}
.navbar-brand span{font-style:italic}
</style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark px-3">
 <span class="navbar-brand">Historian<span>Web</span></span>
 <span id="today" class="text-white"></span>
</nav>

<ul class="nav nav-pills justify-content-center mt-2">
 <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#events">Events</button></li>
 <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#births">Births</button></li>
 <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#deaths">Deaths</button></li>
 <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#holidays">Holidays</button></li>
</ul>

<main class="container-fluid mt-3">
 <div class="tab-content">
  <div id="events" class="tab-pane fade show active card p-3"></div>
  <div id="births" class="tab-pane fade card p-3"></div>
  <div id="deaths" class="tab-pane fade card p-3"></div>
  <div id="holidays" class="tab-pane fade card p-3"></div>
 </div>
</main>

<div class="footer">Sage India</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const DATA_KEY='historian_data';
const FAV_KEY='historian_favs';
const today=new Date();
document.getElementById('today').textContent=
 today.toLocaleDateString(undefined,{month:'long',day:'numeric'});

let favs=JSON.parse(localStorage.getItem(FAV_KEY)||'[]');
let lastData=null;

const clean=t=>t.replace(/\[[^\]]*]/g,'').trim();
const isFav=t=>favs.includes(t);
const toggleFav=t=>{
 favs=isFav(t)?favs.filter(x=>x!==t):[...favs,t];
 localStorage.setItem(FAV_KEY,JSON.stringify(favs));
 renderAll(lastData);
};

function render(id,list){
 const el=document.getElementById(id);
 el.innerHTML=`
 <input class="form-control mb-2 search" placeholder="Search">
 <table class="table"><tbody>
 ${list.map(x=>`
  <tr><td>
   <span class="heart" data-t="${x}">${isFav(x)?'ðŸ©µ':'â™¡'}</span>${clean(x)}
  </td></tr>`).join('')}
 </tbody></table>`;
 el.querySelectorAll('.heart').forEach(h=>h.onclick=()=>toggleFav(h.dataset.t));

 const rows=[...el.querySelectorAll('tbody tr')];
 el.querySelector('.search').oninput=e=>{
  const q=e.target.value.toLowerCase();
  rows.forEach(r=>r.style.display=
   r.textContent.toLowerCase().includes(q)?'':'none');
 };
}

/* ===== MOBILE-SAFE PARSER ===== */
function parseSection(html,id){
 const doc=new DOMParser().parseFromString(html,'text/html');
 const out=[];
 const anchor=doc.querySelector(`span#${id}`);
 if(!anchor) return out;

 let sec=anchor.closest('.mw-heading,.mw-heading2');
 let el=sec.nextElementSibling;

 while(el && !el.matches('.mw-heading,.mw-heading2')){
  if(el.tagName==='UL'){
   el.querySelectorAll(':scope>li').forEach(li=>{
    if(li.querySelector('ul')) return;
    li.querySelectorAll('sup,a').forEach(x=>x.replaceWith(x.textContent));
    out.push(li.textContent.trim());
   });
  }
  el=el.nextElementSibling;
 }
 return out;
}

async function init(){
 const cache=JSON.parse(localStorage.getItem(DATA_KEY)||'null');
 if(cache&&cache.date===today.toDateString()) lastData=cache.data;
 else{
  const page=`${today.toLocaleString('default',{month:'long'})}_${today.getDate()}`;
  const r=await fetch(`https://en.wikipedia.org/w/api.php?action=parse&format=json&prop=text&page=${page}&origin=*`);
  const j=await r.json();
  const html=j.parse.text['*'];
  lastData={
   events:parseSection(html,'Events'),
   births:parseSection(html,'Births'),
   deaths:parseSection(html,'Deaths'),
   holidays:parseSection(html,'Holidays_and_observances')
  };
  localStorage.setItem(DATA_KEY,JSON.stringify({date:today.toDateString(),data:lastData}));
 }
 renderAll(lastData);
}

function renderAll(d){
 render('events',d.events);
 render('births',d.births);
 render('deaths',d.deaths);
 render('holidays',d.holidays);
}

init();

/* Swipe navigation */
let xStart=null;
document.addEventListener('touchstart',e=>xStart=e.touches[0].clientX);
document.addEventListener('touchend',e=>{
 if(!xStart)return;
 const dx=e.changedTouches[0].clientX-xStart;
 if(Math.abs(dx)>50){
  const tabs=[...document.querySelectorAll('.nav-link')];
  const i=tabs.findIndex(t=>t.classList.contains('active'));
  const next=tabs[i+(dx<0?1:-1)];
  if(next) next.click();
 }
 xStart=null;
});
</script>

</body>
</html>
